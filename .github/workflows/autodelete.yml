      - name: Debug and Cleanup
        env:
          # åŠ¡å¿…ç¡®ä¿è¿™é‡Œå¼•ç”¨çš„æ˜¯ä½ è®¾ç½®çš„ secret åå­—ï¼Œé€šå¸¸æ˜¯ PAT
          GITHUB_TOKEN: ${{ secrets.PAT }}
          REPO: ${{ github.repository }}
        run: |
          python -c "
          import requests, os, json, sys

          # --- 1. åŸºç¡€é…ç½®æ£€æŸ¥ ---
          token = os.environ.get('GITHUB_TOKEN')
          repo_full = os.environ.get('REPO')
          if not token or not repo_full:
              print('âŒ Error: GITHUB_TOKEN or REPO env var is missing')
              sys.exit(1)
              
          owner, repo_name = repo_full.split('/')
          print(f'â„¹ï¸  Repository: {repo_full}')
          print(f'â„¹ï¸  Owner: {owner}')
          print(f'â„¹ï¸  Repo Name: {repo_name}')
          print(f'â„¹ï¸  Token Length: {len(token)} (Should be > 0)')

          headers = {
              'Accept': 'application/vnd.github+json',
              'Authorization': f'token {token}',
              'X-GitHub-Api-Version': '2022-11-28'
          }

          # --- 2. æ£€æŸ¥ Token æƒé™å’Œå½’å± ---
          print('\nğŸ” Checking Token Identity...')
          r_user = requests.get('https://api.github.com/user', headers=headers)
          if r_user.status_code == 200:
              user_login = r_user.json().get('login')
              print(f'âœ… Token works! Logged in as: {user_login}')
          else:
              print(f'âŒ Token invalid. Status: {r_user.status_code}')
              print(f'Response: {r_user.text}')
              sys.exit(1)

          # --- 3. å°è¯•å®šä½åŒ… (å…³é”®æ­¥éª¤) ---
          # å°è¯•ä¸¤ä¸ªå¸¸è§çš„ API è·¯å¾„ï¼šç”¨æˆ·è·¯å¾„å’Œç»„ç»‡è·¯å¾„
          urls_to_test = [
              (f'User Path', f'https://api.github.com/users/{owner}/packages/container/{repo_name}/versions'),
              (f'Org Path', f'https://api.github.com/orgs/{owner}/packages/container/{repo_name}/versions')
          ]

          print('\nğŸ” Testing Package Access...')
          success_url = None
          
          for desc, url in urls_to_test:
              print(f'Testing {desc}: {url} ...')
              r = requests.get(url, headers=headers)
              
              if r.status_code == 200:
                  print(f'âœ… Success! Found versions using {desc}.')
                  success_url = url
                  versions = r.json()
                  print(f'â„¹ï¸  Found {len(versions)} versions.')
                  break
              elif r.status_code == 403:
                  print(f'âŒ 403 Forbidden. Reason: {r.json().get("message")}')
                  print('   -> è¿™æ„å‘³ç€ Token ç¼ºå°‘ delete:packages æƒé™ï¼Œæˆ–è€…ç¼ºå°‘ SSO æˆæƒã€‚')
              elif r.status_code == 404:
                  print(f'âŒ 404 Not Found.')
                  print('   -> è¿™æ„å‘³ç€åŒ…åä¸å¯¹ï¼Œæˆ–è€…ä½ ç”¨äº†ç”¨æˆ·è·¯å¾„å»è®¿é—®ç»„ç»‡èµ„æºï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚')

          if not success_url:
              print('\nâŒ CRITICAL: Could not access package versions via any path.')
              print('è¯·æ£€æŸ¥ï¼š1. Token æ˜¯å¦å‹¾é€‰äº† delete:packagesã€‚ 2. å¦‚æœæ˜¯ç»„ç»‡ä»“åº“ï¼ŒToken æ˜¯å¦ç‚¹äº† "Configure SSO"ã€‚')
              sys.exit(1)

          # --- 4. å¦‚æœæˆåŠŸï¼Œæ‰§è¡Œæ¸…ç† (æ­¤å¤„ä»…æ¨¡æ‹Ÿ) ---
          print('\nâœ… Configuration is correct. You can now run the delete logic.')
          print('To enable deletion, replace this script with the actual deletion code using the successful URL detected above.')
          "
